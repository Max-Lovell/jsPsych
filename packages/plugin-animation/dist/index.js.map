{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"animation\",\n  version: version,\n  parameters: {\n    /** Each element of the array is a path to an image file. */\n    stimuli: {\n      type: ParameterType.IMAGE,\n      default: undefined,\n      array: true,\n    },\n    /** How long to display each image in milliseconds. */\n    frame_time: {\n      type: ParameterType.INT,\n      default: 250,\n    },\n    /** If greater than 0, then a gap will be shown between each image in the sequence. This parameter\n     * specifies the length of the gap in milliseconds.\n     */\n    frame_isi: {\n      type: ParameterType.INT,\n      default: 0,\n    },\n    /** How many times to show the entire sequence. There will be no gap (other than the gap specified by `frame_isi`)\n     * between repetitions. */\n    sequence_reps: {\n      type: ParameterType.INT,\n      default: 1,\n    },\n    /** This array contains the key(s) that the participant is allowed to press in order to respond to the stimulus.\n     * Keys should be specified as characters (e.g., `'a'`, `'q'`, `' '`, `'Enter'`, `'ArrowDown'`) - see\n     * [this page](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values) and\n     * [this page (event.key column)](https://www.freecodecamp.org/news/javascript-keycode-list-keypress-event-key-codes/)\n     * for more examples. Any key presses that are not listed in the array will be ignored. The default value of `\"ALL_KEYS\"`\n     * means that all keys will be accepted as valid responses. Specifying `\"NO_KEYS\"` will mean that no responses are allowed. */\n    choices: {\n      type: ParameterType.KEYS,\n      default: \"ALL_KEYS\",\n    },\n    /** This string can contain HTML markup. Any content here will be displayed below the stimulus. The intention is that\n     * it can be used to provide a reminder about the action the participant is supposed to take (e.g., which key(s) to press). */\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    /**\n     * If true, the images will be drawn onto a canvas element. This prevents a blank screen (white flash) between consecutive\n     * images in some browsers, like Firefox and Edge. If false, the image will be shown via an img element, as in previous\n     * versions of jsPsych.\n     */\n    render_on_canvas: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n  },\n  data: {\n    /** An array, where each element is an object that represents a stimulus in the animation sequence. Each object has\n     * a `stimulus` property, which is the image that was displayed, and a `time` property, which is the time in ms,\n     * measured from when the sequence began, that the stimulus was displayed. The array will be encoded in JSON format\n     * when data is saved using either the `.json()` or `.csv()` functions.\n     */\n    animation_sequence: {\n      type: ParameterType.COMPLEX,\n      array: true,\n      parameters: {\n        stimulus: {\n          type: ParameterType.STRING,\n        },\n        time: {\n          type: ParameterType.INT,\n        },\n      },\n    },\n    /** An array, where each element is an object representing a response given by the participant. Each object has a\n     * `stimulus` property, indicating which image was displayed when the key was pressed, an `rt` property, indicating\n     * the time of the key press relative to the start of the animation, and a `key_press` property, indicating which\n     * key was pressed. The array will be encoded in JSON format when data is saved using either the `.json()` or `.csv()`\n     * functions.\n     */\n    response: {\n      type: ParameterType.COMPLEX,\n      array: true,\n      parameters: {\n        stimulus: {\n          type: ParameterType.STRING,\n        },\n        rt: {\n          type: ParameterType.INT,\n        },\n        key_press: {\n          type: ParameterType.STRING,\n        },\n      },\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * This plugin displays a sequence of images at a fixed frame rate. The sequence can be looped a specified number of times.\n * The participant is free to respond at any point during the animation, and the time of the response is recorded.\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/animation/ animation plugin documentation on jspsych.org}\n */\nclass AnimationPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var interval_time = trial.frame_time + trial.frame_isi;\n    var animate_frame = 0;\n    var reps = 0;\n    var startTime = performance.now();\n    var animation_sequence = [];\n    var responses = [];\n    var current_stim = \"\";\n\n    if (trial.render_on_canvas) {\n      // first clear the display element (because the render_on_canvas method appends to display_element instead of overwriting it with .innerHTML)\n      if (display_element.hasChildNodes()) {\n        // can't loop through child list because the list will be modified by .removeChild()\n        while (display_element.firstChild) {\n          display_element.removeChild(display_element.firstChild);\n        }\n      }\n      var canvas = document.createElement(\"canvas\");\n      canvas.id = \"jspsych-animation-image\";\n      canvas.style.margin = \"0\";\n      canvas.style.padding = \"0\";\n      display_element.insertBefore(canvas, null);\n      var ctx = canvas.getContext(\"2d\");\n    }\n\n    const endTrial = () => {\n      this.jsPsych.pluginAPI.cancelKeyboardResponse(response_listener);\n\n      var trial_data = {\n        animation_sequence: animation_sequence,\n        response: responses,\n      };\n\n      this.jsPsych.finishTrial(trial_data);\n    };\n\n    var animate_interval = setInterval(() => {\n      var showImage = true;\n      if (!trial.render_on_canvas) {\n        display_element.innerHTML = \"\"; // clear everything\n      }\n      animate_frame++;\n      if (animate_frame == trial.stimuli.length) {\n        animate_frame = 0;\n        reps++;\n        if (reps >= trial.sequence_reps) {\n          endTrial();\n          clearInterval(animate_interval);\n          showImage = false;\n        }\n      }\n      if (showImage) {\n        show_next_frame();\n      }\n    }, interval_time);\n\n    const show_next_frame = () => {\n      if (trial.render_on_canvas) {\n        display_element.querySelector<HTMLElement>(\"#jspsych-animation-image\").style.visibility =\n          \"visible\";\n        var img = new Image();\n        img.src = trial.stimuli[animate_frame];\n        canvas.height = img.naturalHeight;\n        canvas.width = img.naturalWidth;\n        ctx.drawImage(img, 0, 0);\n        if (trial.prompt !== null && animate_frame == 0 && reps == 0) {\n          display_element.insertAdjacentHTML(\"beforeend\", trial.prompt);\n        }\n      } else {\n        // show image\n        display_element.innerHTML =\n          '<img src=\"' + trial.stimuli[animate_frame] + '\" id=\"jspsych-animation-image\"></img>';\n        if (trial.prompt !== null) {\n          display_element.innerHTML += trial.prompt;\n        }\n      }\n      current_stim = trial.stimuli[animate_frame];\n\n      // record when image was shown\n      animation_sequence.push({\n        stimulus: trial.stimuli[animate_frame],\n        time: Math.round(performance.now() - startTime),\n      });\n\n      if (trial.frame_isi > 0) {\n        this.jsPsych.pluginAPI.setTimeout(() => {\n          display_element.querySelector<HTMLElement>(\"#jspsych-animation-image\").style.visibility =\n            \"hidden\";\n          current_stim = \"blank\";\n          // record when blank image was shown\n          animation_sequence.push({\n            stimulus: \"blank\",\n            time: Math.round(performance.now() - startTime),\n          });\n        }, trial.frame_time);\n      }\n    };\n\n    var after_response = (info) => {\n      responses.push({\n        key_press: info.key,\n        rt: info.rt,\n        stimulus: current_stim,\n      });\n\n      // after a valid response, the stimulus will have the CSS class 'responded'\n      // which can be used to provide visual feedback that a response was recorded\n      display_element.querySelector(\"#jspsych-animation-image\").className += \" responded\";\n    };\n\n    // hold the jspsych response listener object in memory\n    // so that we can turn off the response collection when\n    // the trial ends\n    var response_listener = this.jsPsych.pluginAPI.getKeyboardResponse({\n      callback_function: after_response,\n      valid_responses: trial.choices,\n      rt_method: \"performance\",\n      persist: true,\n      allow_held_key: false,\n    });\n\n    // show the first frame immediately\n    show_next_frame();\n  }\n\n  simulate(\n    trial: TrialType<Info>,\n    simulation_mode,\n    simulation_options: any,\n    load_callback: () => void\n  ) {\n    if (simulation_mode == \"data-only\") {\n      load_callback();\n      this.simulate_data_only(trial, simulation_options);\n    }\n    if (simulation_mode == \"visual\") {\n      this.simulate_visual(trial, simulation_options, load_callback);\n    }\n  }\n\n  private create_simulation_data(trial: TrialType<Info>, simulation_options) {\n    const fake_animation_sequence = [];\n    const fake_responses = [];\n    let t = 0;\n    const check_if_fake_response_generated: () => boolean = () => {\n      return this.jsPsych.randomization.sampleWithReplacement([true, false], 1, [1, 10])[0];\n    };\n    for (let i = 0; i < trial.sequence_reps; i++) {\n      for (const frame of trial.stimuli) {\n        fake_animation_sequence.push({\n          stimulus: frame,\n          time: t,\n        });\n        if (check_if_fake_response_generated()) {\n          fake_responses.push({\n            key_press: this.jsPsych.pluginAPI.getValidKey(trial.choices),\n            rt: t + this.jsPsych.randomization.randomInt(0, trial.frame_time - 1),\n            current_stim: frame,\n          });\n        }\n        t += trial.frame_time;\n        if (trial.frame_isi > 0) {\n          fake_animation_sequence.push({\n            stimulus: \"blank\",\n            time: t,\n          });\n          if (check_if_fake_response_generated()) {\n            fake_responses.push({\n              key_press: this.jsPsych.pluginAPI.getValidKey(trial.choices),\n              rt: t + this.jsPsych.randomization.randomInt(0, trial.frame_isi - 1),\n              current_stim: \"blank\",\n            });\n          }\n          t += trial.frame_isi;\n        }\n      }\n    }\n\n    const default_data = {\n      animation_sequence: fake_animation_sequence,\n      response: fake_responses,\n    };\n\n    const data = this.jsPsych.pluginAPI.mergeSimulationData(default_data, simulation_options);\n\n    this.jsPsych.pluginAPI.ensureSimulationDataConsistency(trial, data);\n\n    return data;\n  }\n\n  private simulate_data_only(trial: TrialType<Info>, simulation_options) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    this.jsPsych.finishTrial(data);\n  }\n\n  private simulate_visual(trial: TrialType<Info>, simulation_options, load_callback: () => void) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    const display_element = this.jsPsych.getDisplayElement();\n\n    this.trial(display_element, trial);\n    load_callback();\n\n    for (const response of data.response) {\n      this.jsPsych.pluginAPI.pressKey(response.key_press, response.rt);\n    }\n  }\n}\n\nexport default AnimationPlugin;\n"],"names":["version","info"],"mappings":"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"}