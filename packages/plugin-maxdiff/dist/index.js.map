{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"maxdiff\",\n  version: version,\n  parameters: {\n    /** An array of one or more alternatives of string type to fill the rows of the maxdiff table. If `required` is true,\n     * then the array must contain two or more alternatives, so that at least one can be selected for both the left\n     * and right columns.  */\n    alternatives: {\n      type: ParameterType.STRING,\n      array: true,\n      default: undefined,\n    },\n    /** An array with exactly two labels of string type to display as column headings (to the left and right of the\n     * alternatives) for responses on the criteria of interest. */\n    labels: {\n      type: ParameterType.STRING,\n      array: true,\n      default: undefined,\n    },\n    /** If true, the display order of `alternatives` is randomly determined at the start of the trial. */\n    randomize_alternative_order: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** HTML formatted string to display at the top of the page above the maxdiff table. */\n    preamble: {\n      type: ParameterType.HTML_STRING,\n      default: \"\",\n    },\n    /** Label of the button to submit response. */\n    button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** If true, prevents the user from submitting the response and proceeding until a radio button in both the left and right response columns has been selected. */\n    required: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n  },\n  data: {\n    /** The response time in milliseconds for the participant to make a response. The time is measured from when the maxdiff table first\n     * appears on the screen until the participant's response. */\n    rt: {\n      type: ParameterType.INT,\n    },\n    /** An object with two keys, `left` and `right`, containing the labels (strings) corresponding to the left and right response\n     * columns. This will be encoded as a JSON string when data is saved using the `.json()` or `.csv()` functions.  */\n    labels: {\n      type: ParameterType.COMPLEX,\n      parameters: {\n        left: {\n          type: ParameterType.STRING,\n        },\n        right: {\n          type: ParameterType.STRING,\n        },\n      },\n    },\n    /** An object with two keys, `left` and `right`, containing the alternatives selected on the left and right columns.\n     * This will be encoded as a JSON string when data is saved using the `.json()` or `.csv()` functions. */\n    response: {\n      type: ParameterType.COMPLEX,\n      parameters: {\n        left: {\n          type: ParameterType.STRING,\n        },\n        right: {\n          type: ParameterType.STRING,\n        },\n      },\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * The maxdiff plugin displays a table with rows of alternatives to be selected for two mutually-exclusive categories,\n * typically as 'most' or 'least' on a particular criteria (e.g. importance, preference, similarity). The participant\n * responds by selecting one radio button corresponding to an alternative in both the left and right response columns.\n * The same alternative cannot be endorsed on both the left and right response columns (e.g. 'most' and 'least') simultaneously.\n *\n * @author Angus Hughes\n * @see {@link https://www.jspsych.org/latest/plugins/maxdiff/ maxdiff plugin documentation on jspsych.org}\n */\nclass MaxdiffPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var html = \"\";\n    // inject CSS for trial\n    html += '<style id=\"jspsych-maxdiff-css\">';\n    html +=\n      \".jspsych-maxdiff-statement {display:block; font-size: 16px; padding-top: 40px; margin-bottom:10px;}\" +\n      \"table.jspsych-maxdiff-table {border-collapse: collapse; padding: 15px; margin-left: auto; margin-right: auto;}\" +\n      \"table.jspsych-maxdiff-table td, th {border-bottom: 1px solid #dddddd; text-align: center; padding: 8px;}\" +\n      \"table.jspsych-maxdiff-table tr:nth-child(even) {background-color: #dddddd;}\";\n    html += \"</style>\";\n\n    // show preamble text\n    if (trial.preamble !== null) {\n      html +=\n        '<div id=\"jspsych-maxdiff-preamble\" class=\"jspsych-maxdiff-preamble\">' +\n        trial.preamble +\n        \"</div>\";\n    }\n    html += '<form id=\"jspsych-maxdiff-form\">';\n\n    // add maxdiff options ///\n    // first generate alternative order, randomized here as opposed to randomizing the order of alternatives\n    // so that the data are always associated with the same alternative regardless of order.\n    var alternative_order = [];\n    for (var i = 0; i < trial.alternatives.length; i++) {\n      alternative_order.push(i);\n    }\n    if (trial.randomize_alternative_order) {\n      alternative_order = this.jsPsych.randomization.shuffle(alternative_order);\n    }\n\n    // Start with column headings\n    var maxdiff_table =\n      '<table class=\"jspsych-maxdiff-table\"><tr><th id=\"jspsych-maxdiff-left-label\">' +\n      trial.labels[0] +\n      '</th><th></th><th id=\"jspsych-maxdiff-right-label\">' +\n      trial.labels[1] +\n      \"</th></tr>\";\n\n    // construct each row of the maxdiff table\n    for (var i = 0; i < trial.alternatives.length; i++) {\n      var alternative = trial.alternatives[alternative_order[i]];\n      // add alternative\n      maxdiff_table +=\n        '<tr><td><input class= \"jspsych-maxdiff-alt-' +\n        i.toString() +\n        '\" type=\"radio\" name=\"left\" data-name = ' +\n        alternative_order[i].toString() +\n        \" /><br></td>\";\n      maxdiff_table +=\n        '<td id=\"jspsych-maxdiff-alternative-' + i.toString() + '\">' + alternative + \"</td>\";\n      maxdiff_table +=\n        '<td><input class= \"jspsych-maxdiff-alt-' +\n        i.toString() +\n        '\" type=\"radio\" name=\"right\" data-name = ' +\n        alternative_order[i].toString() +\n        \" /><br></td></tr>\";\n    }\n    maxdiff_table += \"</table><br><br>\";\n    html += maxdiff_table;\n\n    // add submit button\n    var enable_submit = trial.required == true ? 'disabled = \"disabled\"' : \"\";\n    html +=\n      '<input type=\"submit\" id=\"jspsych-maxdiff-next\" class=\"jspsych-maxdiff jspsych-btn\" ' +\n      enable_submit +\n      ' value=\"' +\n      trial.button_label +\n      '\"></input>';\n    html += \"</form>\";\n\n    display_element.innerHTML = html;\n\n    // function to control responses\n    // first checks that the same alternative cannot be endorsed in the left and right columns simultaneously.\n    // then enables the submit button if the trial is required.\n    const left_right = [\"left\", \"right\"];\n    left_right.forEach((p) => {\n      // Get all elements either 'left' or 'right'\n      document.getElementsByName(p).forEach((alt) => {\n        alt.addEventListener(\"click\", () => {\n          // Find the opposite (if left, then right & vice versa) identified by the class (jspsych-maxdiff-alt-1, 2, etc)\n          var op = alt[\"name\"] == \"left\" ? \"right\" : \"left\";\n          var n = document.getElementsByClassName(alt.className).namedItem(op);\n          // If it's checked, uncheck it.\n          if (n[\"checked\"]) {\n            n[\"checked\"] = false;\n          }\n\n          // check response\n          if (trial.required) {\n            // Now check if one of both left and right have been enabled to allow submission\n            var left_checked = Array.from(document.getElementsByName(\"left\")).some(\n              (c: HTMLInputElement) => c.checked\n            );\n            var right_checked = Array.from(document.getElementsByName(\"right\")).some(\n              (c: HTMLInputElement) => c.checked\n            );\n            if (left_checked && right_checked) {\n              (document.getElementById(\"jspsych-maxdiff-next\") as HTMLInputElement).disabled =\n                false;\n            } else {\n              (document.getElementById(\"jspsych-maxdiff-next\") as HTMLInputElement).disabled = true;\n            }\n          }\n        });\n      });\n    });\n\n    // Get the data once the submit button is clicked\n    // Get the data once the submit button is clicked\n    display_element.querySelector(\"#jspsych-maxdiff-form\").addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n\n      // measure response time\n      var endTime = performance.now();\n      var response_time = Math.round(endTime - startTime);\n\n      // get the alternative by the data-name attribute, allowing a null response if unchecked\n      function get_response(side) {\n        var col = display_element.querySelectorAll('[name=\"' + side + '\"]:checked')[0];\n        if (col === undefined) {\n          return null;\n        } else {\n          var i = parseInt(col.getAttribute(\"data-name\"));\n          return trial.alternatives[i];\n        }\n      }\n\n      // data saving\n      var trial_data = {\n        rt: response_time,\n        labels: { left: trial.labels[0], right: trial.labels[1] },\n        response: { left: get_response(\"left\"), right: get_response(\"right\") },\n      };\n\n      // next trial\n      this.jsPsych.finishTrial(trial_data);\n    });\n\n    var startTime = performance.now();\n  }\n\n  simulate(\n    trial: TrialType<Info>,\n    simulation_mode,\n    simulation_options: any,\n    load_callback: () => void\n  ) {\n    if (simulation_mode == \"data-only\") {\n      load_callback();\n      this.simulate_data_only(trial, simulation_options);\n    }\n    if (simulation_mode == \"visual\") {\n      this.simulate_visual(trial, simulation_options, load_callback);\n    }\n  }\n\n  private create_simulation_data(trial: TrialType<Info>, simulation_options) {\n    const choices = this.jsPsych.randomization.sampleWithoutReplacement(trial.alternatives, 2);\n    const response = { left: null, right: null };\n    if (!trial.required && this.jsPsych.randomization.sampleBernoulli(0.1)) {\n      choices.pop();\n      if (this.jsPsych.randomization.sampleBernoulli(0.8)) {\n        choices.pop();\n      }\n    }\n\n    if (choices.length == 1) {\n      if (this.jsPsych.randomization.sampleBernoulli(0.5)) {\n        response.left = choices[0];\n      } else {\n        response.right = choices[0];\n      }\n    }\n\n    if (choices.length == 2) {\n      response.left = choices[0];\n      response.right = choices[1];\n    }\n\n    const default_data = {\n      rt: this.jsPsych.randomization.sampleExGaussian(3000, 300, 1 / 300, true),\n      labels: trial.labels,\n      response: response,\n    };\n\n    const data = this.jsPsych.pluginAPI.mergeSimulationData(default_data, simulation_options);\n\n    this.jsPsych.pluginAPI.ensureSimulationDataConsistency(trial, data);\n\n    return data;\n  }\n\n  private simulate_data_only(trial: TrialType<Info>, simulation_options) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    this.jsPsych.finishTrial(data);\n  }\n\n  private simulate_visual(trial: TrialType<Info>, simulation_options, load_callback: () => void) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    const display_element = this.jsPsych.getDisplayElement();\n\n    this.trial(display_element, trial);\n    load_callback();\n\n    //@ts-ignore something about symbol iterators?\n    const list = [...display_element.querySelectorAll(\"[id^=jspsych-maxdiff-alternative]\")].map(\n      (x) => {\n        return x.innerHTML;\n      }\n    );\n\n    if (data.response.left !== null) {\n      const index_left = list.indexOf(data.response.left);\n      this.jsPsych.pluginAPI.clickTarget(\n        display_element.querySelector(`.jspsych-maxdiff-alt-${index_left}[name=\"left\"]`),\n        data.rt / 3\n      );\n    }\n\n    if (data.response.right !== null) {\n      const index_right = list.indexOf(data.response.right);\n      this.jsPsych.pluginAPI.clickTarget(\n        display_element.querySelector(`.jspsych-maxdiff-alt-${index_right}[name=\"right\"]`),\n        (data.rt / 3) * 2\n      );\n    }\n\n    this.jsPsych.pluginAPI.clickTarget(\n      display_element.querySelector(\"#jspsych-maxdiff-next\"),\n      data.rt\n    );\n  }\n}\n\nexport default MaxdiffPlugin;\n"],"names":["version","i"],"mappings":"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"}