{"version":3,"file":"index.browser.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"resize\",\n  version: version,\n  parameters: {\n    /** The height of the item to be measured. Any units can be used\n     * as long as you are consistent with using the same units for\n     * all parameters. */\n    item_height: {\n      type: ParameterType.INT,\n      default: 1,\n    },\n    /** The width of the item to be measured. */\n    item_width: {\n      type: ParameterType.INT,\n      default: 1,\n    },\n    /** The content displayed below the resizable box and above the button. */\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    /** After the scaling factor is applied, this many pixels will equal one unit of measurement. */\n    pixels_per_unit: {\n      type: ParameterType.INT,\n      default: 100,\n    },\n    /** The initial size of the box, in pixels, along the largest dimension.\n     * The aspect ratio will be set automatically to match the item width and height. */\n    starting_size: {\n      type: ParameterType.INT,\n      default: 100,\n    },\n    /** Label to display on the button to complete calibration. */\n    button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n  },\n  data: {\n    /** Final width of the resizable div container, in pixels. */\n    final_width_px: {\n      type: ParameterType.INT,\n    },\n    /** Scaling factor that will be applied to the div containing jsPsych content. */\n    scale_factor: {\n      type: ParameterType.FLOAT,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n *\n * This plugin displays a resizable div container that allows the user to drag until the container is the same size as the\n * item being measured. Once the user measures the item as close as possible, clicking the button sets a scaling factor\n * for the div containing jsPsych content. This causes the stimuli that follow to have a known size, independent of monitor resolution.\n *\n * @author Steve Chao\n * @see {@link https://www.jspsych.org/latest/plugins/resize/ resize plugin documentation on jspsych.org}\n */\nclass ResizePlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var aspect_ratio = trial.item_width / trial.item_height;\n\n    // variables to determine div size\n    if (trial.item_width >= trial.item_height) {\n      var start_div_width = trial.starting_size as number;\n      var start_div_height = Math.round(trial.starting_size / aspect_ratio);\n    } else {\n      var start_div_height = trial.starting_size as number;\n      var start_div_width = Math.round(trial.starting_size * aspect_ratio);\n    }\n\n    // create html for display\n    var html =\n      '<div id=\"jspsych-resize-div\" style=\"border: 2px solid steelblue; height: ' +\n      start_div_height +\n      \"px; width:\" +\n      start_div_width +\n      'px; margin: 7px auto; background-color: lightsteelblue; position: relative;\">';\n    html +=\n      '<div id=\"jspsych-resize-handle\" style=\"cursor: nwse-resize; background-color: steelblue; width: 10px; height: 10px; border: 2px solid lightsteelblue; position: absolute; bottom: 0; right: 0;\"></div>';\n    html += \"</div>\";\n    if (trial.prompt !== null) {\n      html += trial.prompt;\n    }\n    html += '<a class=\"jspsych-btn\" id=\"jspsych-resize-btn\">' + trial.button_label + \"</a>\";\n\n    // render\n    display_element.innerHTML = html;\n\n    // function to end trial\n    const end_trial = () => {\n      // clear document event listeners\n      document.removeEventListener(\"mousemove\", resizeevent);\n      document.removeEventListener(\"mouseup\", mouseupevent);\n\n      // finishes trial\n\n      var trial_data = {\n        final_height_px: final_height_px,\n        final_width_px: final_width_px,\n        scale_factor: scale_factor,\n      };\n\n      this.jsPsych.finishTrial(trial_data);\n    };\n\n    // listens for the click\n    document.getElementById(\"jspsych-resize-btn\").addEventListener(\"click\", () => {\n      scale();\n      end_trial();\n    });\n\n    var dragging = false;\n    var origin_x, origin_y;\n    var cx, cy;\n\n    var mousedownevent = (e) => {\n      e.preventDefault();\n      dragging = true;\n      origin_x = e.pageX;\n      origin_y = e.pageY;\n      cx = parseInt(scale_div.style.width);\n      cy = parseInt(scale_div.style.height);\n    };\n\n    display_element\n      .querySelector(\"#jspsych-resize-handle\")\n      .addEventListener(\"mousedown\", mousedownevent);\n\n    var mouseupevent = (e) => {\n      dragging = false;\n    };\n\n    document.addEventListener(\"mouseup\", mouseupevent);\n\n    var scale_div: HTMLDivElement = display_element.querySelector(\"#jspsych-resize-div\");\n\n    var resizeevent = (e) => {\n      if (dragging) {\n        var dx = e.pageX - origin_x;\n        var dy = e.pageY - origin_y;\n\n        if (Math.abs(dx) >= Math.abs(dy)) {\n          scale_div.style.width = Math.round(Math.max(20, cx + dx * 2)) + \"px\";\n          scale_div.style.height = Math.round(Math.max(20, cx + dx * 2) / aspect_ratio) + \"px\";\n        } else {\n          scale_div.style.height = Math.round(Math.max(20, cy + dy * 2)) + \"px\";\n          scale_div.style.width = Math.round(aspect_ratio * Math.max(20, cy + dy * 2)) + \"px\";\n        }\n      }\n    };\n\n    document.addEventListener(\"mousemove\", resizeevent);\n\n    // scales the stimulus\n    var scale_factor;\n    var final_height_px, final_width_px;\n    function scale() {\n      final_width_px = scale_div.offsetWidth;\n      //final_height_px = scale_div.offsetHeight;\n\n      var pixels_unit_screen = final_width_px / trial.item_width;\n\n      scale_factor = pixels_unit_screen / trial.pixels_per_unit;\n      document.getElementById(\"jspsych-content\").style.transform = \"scale(\" + scale_factor + \")\";\n    }\n  }\n}\n\nexport default ResizePlugin;\n"],"names":["version","ParameterType"],"mappings":"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"}