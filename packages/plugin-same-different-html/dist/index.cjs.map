{"version":3,"file":"index.cjs","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"same-different-html\",\n  version: version,\n  parameters: {\n    /** A pair of stimuli, represented as an array with two entries, one for\n     * each stimulus. A stimulus is a string containing valid HTML markup.\n     * Stimuli will be shown in the order that they are defined in the array. */\n    stimuli: {\n      type: ParameterType.HTML_STRING,\n      default: undefined,\n      array: true,\n    },\n    /** Correct answer: either \"same\" or \"different\". */\n    answer: {\n      type: ParameterType.SELECT,\n      options: [\"same\", \"different\"],\n      default: undefined,\n    },\n    /** The key that subjects should press to indicate that the two stimuli are the same. */\n    same_key: {\n      type: ParameterType.KEY,\n      default: \"q\",\n    },\n    /** The key that subjects should press to indicate that the two stimuli are different. */\n    different_key: {\n      type: ParameterType.KEY,\n      default: \"p\",\n    },\n    /** How long to show the first stimulus for in milliseconds. If the value of this parameter is null then the stimulus will be shown until the participant presses any key. */\n    first_stim_duration: {\n      type: ParameterType.INT,\n      default: 1000,\n    },\n    /** How long to show a blank screen in between the two stimuli. */\n    gap_duration: {\n      type: ParameterType.INT,\n      default: 500,\n    },\n    /** How long to show the second stimulus for in milliseconds. If null, then the stimulus will remain on the screen until a valid response is made. */\n    second_stim_duration: {\n      type: ParameterType.INT,\n      pretty_name: \"Second stimulus duration\",\n      default: 1000,\n    },\n    /** This string can contain HTML markup. Any content here will be displayed below the stimulus. The intention is that it can be used to provide a reminder about the action the participant is supposed to take (e.g., which key to press). */\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n  },\n  data: {\n    /**  An array of length 2 containing the HTML-formatted content that the participant saw for each trial. This will be encoded as a JSON string\n     * when data is saved using the `.json()` or `.csv()` functions. */\n    stimulus: {\n      type: ParameterType.HTML_STRING,\n      array: true,\n    },\n    /** Indicates which key the participant pressed. */\n    response: {\n      type: ParameterType.STRING,\n    },\n    /** The response time in milliseconds for the participant to make a response. The time is measured from when the second stimulus first appears on the screen until the participant's response. */\n    rt: {\n      type: ParameterType.INT,\n    },\n    /** `true` if the participant's response matched the `answer` for this trial.  */\n    correct: {\n      type: ParameterType.BOOL,\n    },\n    /** The correct answer to the trial, either `'same'` or `'different'`. */\n    answer: {\n      type: ParameterType.STRING,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * The same-different-html plugin displays two stimuli sequentially. Stimuli are HTML objects.\n * The participant responds using the keyboard, and indicates whether the stimuli were the\n * same or different. Same does not necessarily mean identical; a category judgment could be made, for example.\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/same-different-html/ same-different-html plugin documentation on jspsych.org}\n */\nclass SameDifferentHtmlPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    display_element.innerHTML =\n      '<div class=\"jspsych-same-different-stimulus\">' + trial.stimuli[0] + \"</div>\";\n\n    var first_stim_info: { key: string; rt: number };\n    if (trial.first_stim_duration > 0) {\n      this.jsPsych.pluginAPI.setTimeout(() => {\n        showBlankScreen();\n      }, trial.first_stim_duration);\n    } else {\n      const afterKeyboardResponse = (info: { key: string; rt: number }) => {\n        first_stim_info = info;\n        showBlankScreen();\n      };\n      this.jsPsych.pluginAPI.getKeyboardResponse({\n        callback_function: afterKeyboardResponse,\n        valid_responses: \"ALL_KEYS\",\n        rt_method: \"performance\",\n        persist: false,\n        allow_held_key: false,\n      });\n    }\n\n    const showBlankScreen = () => {\n      display_element.innerHTML = \"\";\n\n      this.jsPsych.pluginAPI.setTimeout(showSecondStim, trial.gap_duration);\n    };\n\n    const showSecondStim = () => {\n      var html = '<div class=\"jspsych-same-different-stimulus\">' + trial.stimuli[1] + \"</div>\";\n      //show prompt here\n      if (trial.prompt !== null) {\n        html += trial.prompt;\n      }\n      display_element.innerHTML = html;\n\n      if (trial.second_stim_duration > 0) {\n        this.jsPsych.pluginAPI.setTimeout(() => {\n          display_element.querySelector<HTMLElement>(\n            \".jspsych-same-different-stimulus\"\n          ).style.visibility = \"hidden\";\n        }, trial.second_stim_duration);\n      }\n\n      const after_response = (info: { key: string; rt: number }) => {\n        var correct = false;\n\n        var skey = trial.same_key;\n        var dkey = trial.different_key;\n\n        if (this.jsPsych.pluginAPI.compareKeys(info.key, skey) && trial.answer == \"same\") {\n          correct = true;\n        }\n\n        if (this.jsPsych.pluginAPI.compareKeys(info.key, dkey) && trial.answer == \"different\") {\n          correct = true;\n        }\n\n        var trial_data = {\n          rt: info.rt,\n          answer: trial.answer,\n          correct: correct,\n          stimulus: [trial.stimuli[0], trial.stimuli[1]],\n          response: info.key,\n        };\n        if (first_stim_info) {\n          trial_data[\"rt_stim1\"] = first_stim_info.rt;\n          trial_data[\"response_stim1\"] = first_stim_info.key;\n        }\n\n        this.jsPsych.finishTrial(trial_data);\n      };\n\n      this.jsPsych.pluginAPI.getKeyboardResponse({\n        callback_function: after_response,\n        valid_responses: [trial.same_key, trial.different_key],\n        rt_method: \"performance\",\n        persist: false,\n        allow_held_key: false,\n      });\n    };\n  }\n\n  simulate(\n    trial: TrialType<Info>,\n    simulation_mode,\n    simulation_options: any,\n    load_callback: () => void\n  ) {\n    if (simulation_mode == \"data-only\") {\n      load_callback();\n      this.simulate_data_only(trial, simulation_options);\n    }\n    if (simulation_mode == \"visual\") {\n      this.simulate_visual(trial, simulation_options, load_callback);\n    }\n  }\n\n  private create_simulation_data(trial: TrialType<Info>, simulation_options) {\n    const key = this.jsPsych.pluginAPI.getValidKey([trial.same_key, trial.different_key]);\n\n    const default_data = <any>{\n      stimuli: trial.stimuli,\n      response: key,\n      answer: trial.answer,\n      correct: trial.answer == \"same\" ? key == trial.same_key : key == trial.different_key,\n      rt: this.jsPsych.randomization.sampleExGaussian(500, 50, 1 / 150, true),\n    };\n\n    if (trial.first_stim_duration == null) {\n      default_data.rt_stim1 = this.jsPsych.randomization.sampleExGaussian(500, 50, 1 / 150, true);\n      default_data.response_stim1 = this.jsPsych.pluginAPI.getValidKey([\n        trial.same_key,\n        trial.different_key,\n      ]);\n    }\n\n    const data = this.jsPsych.pluginAPI.mergeSimulationData(default_data, simulation_options);\n\n    this.jsPsych.pluginAPI.ensureSimulationDataConsistency(trial, data);\n\n    return data;\n  }\n\n  private simulate_data_only(trial: TrialType<Info>, simulation_options) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    this.jsPsych.finishTrial(data);\n  }\n\n  private simulate_visual(trial: TrialType<Info>, simulation_options, load_callback: () => void) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    const display_element = this.jsPsych.getDisplayElement();\n\n    this.trial(display_element, trial);\n    load_callback();\n\n    if (trial.first_stim_duration == null) {\n      this.jsPsych.pluginAPI.pressKey(data.response_stim1, data.rt_stim1);\n    }\n\n    this.jsPsych.pluginAPI.pressKey(\n      data.response,\n      trial.first_stim_duration + trial.gap_duration + data.rt\n    );\n  }\n}\n\nexport default SameDifferentHtmlPlugin;\n"],"names":["version","ParameterType","info"],"mappings":"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"}