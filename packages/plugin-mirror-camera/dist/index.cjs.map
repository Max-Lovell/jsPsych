{"version":3,"file":"index.cjs","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"mirror-camera\",\n  version: version,\n  parameters: {\n    /** HTML-formatted content to display below the camera feed. */\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    /** The label of the button to advance to the next trial. */\n    button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** The height of the video playback element. If left `null` then it will match the size of the recording. */\n    height: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /** The width of the video playback element. If left `null` then it will match the size of the recording. */\n    width: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /**  Whether to mirror the video image. */\n    mirror_camera: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n  },\n  data: {\n    /** The length of time the participant viewed the video playback. */\n    rt: {\n      type: ParameterType.INT,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * This plugin shows a live feed of the participant's camera. It can be useful in experiments that need to record video in order to give the participant a chance to see what is in the view of the camera.\n *\n * You must initialize the camera using the [initialize-camera plugin](initialize-camera.md) prior to running this plugin.\n *\n * !!! warning\n *     When recording from a camera your experiment will need to be running over `https://` protocol. If you try to run the experiment locally using the `file://` protocol or over `http://` protocol you will not be able to access the camera because of [potential security problems](https://blog.mozilla.org/webrtc/camera-microphone-require-https-in-firefox-68/).\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/mirror-camera/ mirror-camera plugin documentation on jspsych.org}\n */\nclass MirrorCameraPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  private stream: MediaStream;\n  private start_time: number;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    this.stream = this.jsPsych.pluginAPI.getCameraStream();\n\n    display_element.innerHTML = `\n      <video autoplay playsinline id=\"jspsych-mirror-camera-video\" width=\"${\n        trial.width ? trial.width : \"auto\"\n      }\" height=\"${trial.height ? trial.height : \"auto\"}\" ${\n      trial.mirror_camera ? 'style=\"transform: rotateY(180deg);\"' : \"\"\n    }></video>\n      ${trial.prompt ? `<div id=\"jspsych-mirror-camera-prompt\">${trial.prompt}</div>` : \"\"}\n      <p><button class=\"jspsych-btn\" id=\"btn-continue\">${trial.button_label}</button></p>\n    `;\n\n    (display_element.querySelector(\"#jspsych-mirror-camera-video\") as HTMLVideoElement).srcObject =\n      this.stream;\n\n    display_element.querySelector(\"#btn-continue\").addEventListener(\"click\", () => {\n      this.finish(display_element);\n    });\n\n    this.start_time = performance.now();\n  }\n\n  finish(display_element: HTMLElement) {\n    this.jsPsych.finishTrial({\n      rt: performance.now() - this.start_time,\n    });\n  }\n}\n\nexport default MirrorCameraPlugin;\n"],"names":["version","ParameterType"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,MAAM,IAAc,GAAA;AAAA,EAClB,IAAM,EAAA,eAAA;AAAA,WACNA,gBAAA;AAAA,EACA,UAAY,EAAA;AAAA,IAEV,MAAQ,EAAA;AAAA,MACN,MAAMC,qBAAc,CAAA,WAAA;AAAA,MACpB,OAAS,EAAA,IAAA;AAAA,KACX;AAAA,IAEA,YAAc,EAAA;AAAA,MACZ,MAAMA,qBAAc,CAAA,MAAA;AAAA,MACpB,OAAS,EAAA,UAAA;AAAA,KACX;AAAA,IAEA,MAAQ,EAAA;AAAA,MACN,MAAMA,qBAAc,CAAA,GAAA;AAAA,MACpB,OAAS,EAAA,IAAA;AAAA,KACX;AAAA,IAEA,KAAO,EAAA;AAAA,MACL,MAAMA,qBAAc,CAAA,GAAA;AAAA,MACpB,OAAS,EAAA,IAAA;AAAA,KACX;AAAA,IAEA,aAAe,EAAA;AAAA,MACb,MAAMA,qBAAc,CAAA,IAAA;AAAA,MACpB,OAAS,EAAA,IAAA;AAAA,KACX;AAAA,GACF;AAAA,EACA,IAAM,EAAA;AAAA,IAEJ,EAAI,EAAA;AAAA,MACF,MAAMA,qBAAc,CAAA,GAAA;AAAA,KACtB;AAAA,GACF;AACF,CAAA,CAAA;AAeA,MAAM,kBAAkD,CAAA;AAAA,EAMtD,YAAoB,OAAkB,EAAA;AAAlB,IAAA,IAAA,CAAA,OAAA,GAAA,OAAA,CAAA;AAAA,GAAmB;AAAA,EAEvC,KAAA,CAAM,iBAA8B,KAAwB,EAAA;AAC1D,IAAA,IAAA,CAAK,MAAS,GAAA,IAAA,CAAK,OAAQ,CAAA,SAAA,CAAU,eAAgB,EAAA,CAAA;AAErD,IAAA,eAAA,CAAgB,SAAY,GAAA,CAAA;AAAA,0EAAA,EAExB,KAAM,CAAA,KAAA,GAAQ,KAAM,CAAA,KAAA,GAAQ,MACjB,CAAA,UAAA,EAAA,KAAA,CAAM,MAAS,GAAA,KAAA,CAAM,MAAS,GAAA,MAAA,CAAA,EAAA,EAC3C,KAAM,CAAA,aAAA,GAAgB,qCAAwC,GAAA,EAAA,CAAA;AAAA,MAAA,EAE5D,KAAM,CAAA,MAAA,GAAS,CAA0C,uCAAA,EAAA,KAAA,CAAM,MAAiB,CAAA,MAAA,CAAA,GAAA,EAAA,CAAA;AAAA,uDAAA,EAC/B,KAAM,CAAA,YAAA,CAAA;AAAA,IAAA,CAAA,CAAA;AAG3D,IAAC,eAAgB,CAAA,aAAA,CAAc,8BAA8B,CAAA,CAAuB,YAClF,IAAK,CAAA,MAAA,CAAA;AAEP,IAAA,eAAA,CAAgB,aAAc,CAAA,eAAe,CAAE,CAAA,gBAAA,CAAiB,SAAS,MAAM;AAC7E,MAAA,IAAA,CAAK,OAAO,eAAe,CAAA,CAAA;AAAA,KAC5B,CAAA,CAAA;AAED,IAAK,IAAA,CAAA,UAAA,GAAa,YAAY,GAAI,EAAA,CAAA;AAAA,GACpC;AAAA,EAEA,OAAO,eAA8B,EAAA;AACnC,IAAA,IAAA,CAAK,QAAQ,WAAY,CAAA;AAAA,MACvB,EAAI,EAAA,WAAA,CAAY,GAAI,EAAA,GAAI,IAAK,CAAA,UAAA;AAAA,KAC9B,CAAA,CAAA;AAAA,GACH;AACF,CAAA;AApCM,kBAAA,CACG,IAAO,GAAA,IAAA;;;;"}