{"version":3,"file":"index.browser.min.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"mirror-camera\",\n  version: version,\n  parameters: {\n    /** HTML-formatted content to display below the camera feed. */\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    /** The label of the button to advance to the next trial. */\n    button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** The height of the video playback element. If left `null` then it will match the size of the recording. */\n    height: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /** The width of the video playback element. If left `null` then it will match the size of the recording. */\n    width: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /**  Whether to mirror the video image. */\n    mirror_camera: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n  },\n  data: {\n    /** The length of time the participant viewed the video playback. */\n    rt: {\n      type: ParameterType.INT,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * This plugin shows a live feed of the participant's camera. It can be useful in experiments that need to record video in order to give the participant a chance to see what is in the view of the camera.\n *\n * You must initialize the camera using the [initialize-camera plugin](initialize-camera.md) prior to running this plugin.\n *\n * !!! warning\n *     When recording from a camera your experiment will need to be running over `https://` protocol. If you try to run the experiment locally using the `file://` protocol or over `http://` protocol you will not be able to access the camera because of [potential security problems](https://blog.mozilla.org/webrtc/camera-microphone-require-https-in-firefox-68/).\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/mirror-camera/ mirror-camera plugin documentation on jspsych.org}\n */\nclass MirrorCameraPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  private stream: MediaStream;\n  private start_time: number;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    this.stream = this.jsPsych.pluginAPI.getCameraStream();\n\n    display_element.innerHTML = `\n      <video autoplay playsinline id=\"jspsych-mirror-camera-video\" width=\"${\n        trial.width ? trial.width : \"auto\"\n      }\" height=\"${trial.height ? trial.height : \"auto\"}\" ${\n      trial.mirror_camera ? 'style=\"transform: rotateY(180deg);\"' : \"\"\n    }></video>\n      ${trial.prompt ? `<div id=\"jspsych-mirror-camera-prompt\">${trial.prompt}</div>` : \"\"}\n      <p><button class=\"jspsych-btn\" id=\"btn-continue\">${trial.button_label}</button></p>\n    `;\n\n    (display_element.querySelector(\"#jspsych-mirror-camera-video\") as HTMLVideoElement).srcObject =\n      this.stream;\n\n    display_element.querySelector(\"#btn-continue\").addEventListener(\"click\", () => {\n      this.finish(display_element);\n    });\n\n    this.start_time = performance.now();\n  }\n\n  finish(display_element: HTMLElement) {\n    this.jsPsych.finishTrial({\n      rt: performance.now() - this.start_time,\n    });\n  }\n}\n\nexport default MirrorCameraPlugin;\n"],"names":["info","version","ParameterType","MirrorCameraPlugin","jsPsych","display_element","trial"],"mappings":"u5BAIA,MAAMA,EAAc,CAClB,KAAM,gBACN,QAASC,EAAAA,QACT,WAAY,CAEV,OAAQ,CACN,KAAMC,EAAc,cAAA,YACpB,QAAS,IACX,EAEA,aAAc,CACZ,KAAMA,EAAc,cAAA,OACpB,QAAS,UACX,EAEA,OAAQ,CACN,KAAMA,EAAAA,cAAc,IACpB,QAAS,IACX,EAEA,MAAO,CACL,KAAMA,EAAAA,cAAc,IACpB,QAAS,IACX,EAEA,cAAe,CACb,KAAMA,gBAAc,KACpB,QAAS,EACX,CACF,EACA,KAAM,CAEJ,GAAI,CACF,KAAMA,EAAc,cAAA,GACtB,CACF,CACF,EAeA,MAAMC,CAAkD,CAMtD,YAAoBC,EAAkB,CAAlB,KAAAA,QAAAA,CAAmB,CAEvC,MAAMC,EAA8BC,EAAwB,CAC1D,KAAK,OAAS,KAAK,QAAQ,UAAU,gBAAgB,EAErDD,EAAgB,UAAY;AAAA,4EAExBC,EAAM,MAAQA,EAAM,MAAQ,mBACjBA,EAAM,OAASA,EAAM,OAAS,WAC3CA,EAAM,cAAgB,sCAAwC;AAAA,QAE5DA,EAAM,OAAS,0CAA0CA,EAAM,eAAiB;AAAA,yDAC/BA,EAAM;AAAA,MAG1DD,EAAgB,cAAc,8BAA8B,EAAuB,UAClF,KAAK,OAEPA,EAAgB,cAAc,eAAe,EAAE,iBAAiB,QAAS,IAAM,CAC7E,KAAK,OAAOA,CAAe,CAC7B,CAAC,EAED,KAAK,WAAa,YAAY,IAAI,CACpC,CAEA,OAAOA,EAA8B,CACnC,KAAK,QAAQ,YAAY,CACvB,GAAI,YAAY,IAAQ,EAAA,KAAK,UAC/B,CAAC,CACH,CACF,CApCMF,OAAAA,EACG,KAAOH"}