var jsPsychCategorizeImage = (function (s) {
  "use strict";
  var c = {
    name: "@jspsych/plugin-categorize-image",
    version: "2.0.0",
    description: "jspsych plugin for categorization trials with feedback",
    type: "module",
    main: "dist/index.cjs",
    exports: { import: "./dist/index.js", require: "./dist/index.cjs" },
    typings: "dist/index.d.ts",
    unpkg: "dist/index.browser.min.js",
    files: ["src", "dist"],
    source: "src/index.ts",
    scripts: {
      test: "jest",
      "test:watch": "npm test -- --watch",
      tsc: "tsc",
      build: "rollup --config",
      "build:watch": "npm run build -- --watch",
    },
    repository: {
      type: "git",
      url: "git+https://github.com/jspsych/jsPsych.git",
      directory: "packages/plugin-categorize-image",
    },
    author: "Josh de Leeuw",
    license: "MIT",
    bugs: { url: "https://github.com/jspsych/jsPsych/issues" },
    homepage: "https://www.jspsych.org/latest/plugins/categorize-image",
    peerDependencies: { jspsych: ">=7.1.0" },
    devDependencies: { "@jspsych/config": "^3.0.0", "@jspsych/test-utils": "^1.2.0" },
  };
  const p = {
    name: "categorize-image",
    version: c.version,
    parameters: {
      stimulus: { type: s.ParameterType.IMAGE, default: void 0 },
      key_answer: { type: s.ParameterType.KEY, default: void 0 },
      choices: { type: s.ParameterType.KEYS, default: "ALL_KEYS" },
      text_answer: { type: s.ParameterType.HTML_STRING, default: null },
      correct_text: {
        type: s.ParameterType.HTML_STRING,
        default: "<p class='feedback'>Correct</p>",
      },
      incorrect_text: {
        type: s.ParameterType.HTML_STRING,
        default: "<p class='feedback'>Wrong</p>",
      },
      prompt: { type: s.ParameterType.HTML_STRING, default: null },
      force_correct_button_press: { type: s.ParameterType.BOOL, default: !1 },
      show_stim_with_feedback: { type: s.ParameterType.BOOL, default: !0, no_function: !1 },
      show_feedback_on_timeout: { type: s.ParameterType.BOOL, default: !1 },
      timeout_message: {
        type: s.ParameterType.HTML_STRING,
        default: "<p>Please respond faster.</p>",
      },
      stimulus_duration: { type: s.ParameterType.INT, default: null },
      trial_duration: { type: s.ParameterType.INT, default: null },
      feedback_duration: { type: s.ParameterType.INT, default: 2e3 },
    },
    data: {
      stimulus: { type: s.ParameterType.STRING },
      response: { type: s.ParameterType.STRING },
      rt: { type: s.ParameterType.INT },
      correct: { type: s.ParameterType.BOOL },
    },
  };
  class o {
    constructor(t) {
      this.jsPsych = t;
    }
    trial(t, e) {
      (t.innerHTML =
        '<img id="jspsych-categorize-image-stimulus" class="jspsych-categorize-image-stimulus" src="' +
        e.stimulus +
        '"></img>'),
        e.stimulus_duration !== null &&
          this.jsPsych.pluginAPI.setTimeout(() => {
            t.querySelector("#jspsych-categorize-image-stimulus").style.visibility = "hidden";
          }, e.stimulus_duration),
        e.prompt !== null && (t.innerHTML += e.prompt);
      var a = {};
      const i = (n) => {
        this.jsPsych.pluginAPI.cancelAllKeyboardResponses();
        var l = !1;
        this.jsPsych.pluginAPI.compareKeys(e.key_answer, n.key) && (l = !0),
          (a = { rt: n.rt, correct: l, stimulus: e.stimulus, response: n.key });
        var u = n.rt == null;
        m(l, u);
      };
      this.jsPsych.pluginAPI.getKeyboardResponse({
        callback_function: i,
        valid_responses: e.choices,
        rt_method: "performance",
        persist: !1,
        allow_held_key: !1,
      }),
        e.trial_duration !== null &&
          this.jsPsych.pluginAPI.setTimeout(() => {
            i({ key: null, rt: null });
          }, e.trial_duration);
      const r = () => {
          this.jsPsych.finishTrial(a);
        },
        m = (n, l) => {
          if (l && !e.show_feedback_on_timeout) t.innerHTML += e.timeout_message;
          else {
            e.show_stim_with_feedback &&
              (t.innerHTML =
                '<img id="jspsych-categorize-image-stimulus" class="jspsych-categorize-image-stimulus" src="' +
                e.stimulus +
                '"></img>');
            var u = "";
            n
              ? (u = e.correct_text.replace("%ANS%", e.text_answer))
              : (u = e.incorrect_text.replace("%ANS%", e.text_answer)),
              (t.innerHTML += u);
          }
          if (
            e.force_correct_button_press &&
            n === !1 &&
            ((l && e.show_feedback_on_timeout) || !l)
          ) {
            var d = (_) => {
              r();
            };
            this.jsPsych.pluginAPI.getKeyboardResponse({
              callback_function: d,
              valid_responses: [e.key_answer],
              rt_method: "performance",
              persist: !1,
              allow_held_key: !1,
            });
          } else this.jsPsych.pluginAPI.setTimeout(r, e.feedback_duration);
        };
    }
    simulate(t, e, a, i) {
      e == "data-only" && (i(), this.simulate_data_only(t, a)),
        e == "visual" && this.simulate_visual(t, a, i);
    }
    create_simulation_data(t, e) {
      const a = this.jsPsych.pluginAPI.getValidKey(t.choices),
        i = {
          stimulus: t.stimulus,
          response: a,
          rt: this.jsPsych.randomization.sampleExGaussian(500, 50, 1 / 150, !0),
          correct: a == t.key_answer,
        },
        r = this.jsPsych.pluginAPI.mergeSimulationData(i, e);
      return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t, r), r;
    }
    simulate_data_only(t, e) {
      const a = this.create_simulation_data(t, e);
      this.jsPsych.finishTrial(a);
    }
    simulate_visual(t, e, a) {
      const i = this.create_simulation_data(t, e),
        r = this.jsPsych.getDisplayElement();
      this.trial(r, t),
        a(),
        i.rt !== null && this.jsPsych.pluginAPI.pressKey(i.response, i.rt),
        t.force_correct_button_press &&
          !i.correct &&
          this.jsPsych.pluginAPI.pressKey(t.key_answer, i.rt + t.feedback_duration / 2);
    }
  }
  return (o.info = p), o;
})(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
