{"version":3,"file":"index.cjs","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"categorize-animation\",\n  version: version,\n  parameters: {\n    /** Each element of the array is a path to an image file. */\n    stimuli: {\n      type: ParameterType.IMAGE,\n      default: undefined,\n      array: true,\n    },\n    /** The key character indicating the correct response. */\n    key_answer: {\n      type: ParameterType.KEY,\n      default: undefined,\n    },\n    /** This array contains the key(s) that the participant is allowed to press in order to respond to the stimulus. Keys should be specified as characters (e.g., `'a'`, `'q'`, `' '`, `'Enter'`, `'ArrowDown'`) - see [this page](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values) and [this page (event.key column)](https://www.freecodecamp.org/news/javascript-keycode-list-keypress-event-key-codes/) for more examples. Any key presses that are not listed in the array will be ignored. The default value of `\"ALL_KEYS\"` means that all keys will be accepted as valid responses. Specifying `\"NO_KEYS\"` will mean that no responses are allowed. */\n    choices: {\n      type: ParameterType.KEYS,\n      default: \"ALL_KEYS\",\n    },\n    /** A text label that describes the correct answer. Used in conjunction with the `correct_text` and `incorrect_text` parameters. */\n    text_answer: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    /** String to show when the correct answer is given. Can contain HTML formatting. The special string `%ANS%` can be used within the string. If present, the plugin will put the `text_answer` for the trial in place of the %ANS% string (see example below). */\n    correct_text: {\n      type: ParameterType.HTML_STRING,\n      default: \"Correct.\",\n    },\n    /** String to show when the wrong answer is given. Can contain HTML formatting. The special string `%ANS%` can be used within the string. If present, the plugin will put the `text_answer` for the trial in place of the %ANS% string (see example below). */\n    incorrect_text: {\n      type: ParameterType.HTML_STRING,\n      default: \"Wrong.\",\n    },\n    /** How long to display each image (in milliseconds). */\n    frame_time: {\n      type: ParameterType.INT,\n      default: 500,\n    },\n    /** How many times to show the entire sequence. */\n    sequence_reps: {\n      type: ParameterType.INT,\n      default: 1,\n    },\n    /** If true, the participant can respond before the animation sequence finishes. */\n    allow_response_before_complete: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** How long to show the feedback (milliseconds). */\n    feedback_duration: {\n      type: ParameterType.INT,\n      default: 2000,\n    },\n    /** This string can contain HTML markup. Any content here will be displayed below the stimulus or the end of the animation depending on the allow_response_before_complete parameter. The intention is that it can be used to provide a reminder about the action the participant is supposed to take (e.g., which key to press). */\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    /**\n     * If true, the images will be drawn onto a canvas element. This prevents a blank screen (white flash) between consecutive images in some browsers, like Firefox and Edge.\n     * If false, the image will be shown via an img element, as in previous versions of jsPsych.\n     */\n    render_on_canvas: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n  },\n  data: {\n    /** Array of stimuli displayed in the trial. This will be encoded as a JSON string when data is saved using the `.json()` or `.csv()` functions. */\n    stimulus: {\n      type: ParameterType.STRING,\n      array: true,\n    },\n    /** Indicates which key the participant pressed.  */\n    response: {\n      type: ParameterType.STRING,\n    },\n    /** The response time in milliseconds for the participant to make a response. The time is measured from when the stimulus first appears on the screen until the participant's response. */\n    rt: {\n      type: ParameterType.INT,\n    },\n    /** `true` if the participant got the correct answer, `false` otherwise. */\n    correct: {\n      type: ParameterType.BOOL,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * The categorize animation plugin shows a sequence of images at a specified frame rate. The participant responds by pressing a key. Feedback indicating the correctness of the response is given.\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/categorize-animation/ categorize-animation plugin documentation on jspsych.org}\n */\nclass CategorizeAnimationPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var animate_frame = 0;\n    var reps = 0;\n\n    var showAnimation = true;\n\n    var responded = false;\n    var timeoutSet = false;\n    var correct;\n\n    if (trial.render_on_canvas) {\n      // first clear the display element (because the render_on_canvas method appends to display_element instead of overwriting it with .innerHTML)\n      if (display_element.hasChildNodes()) {\n        // can't loop through child list because the list will be modified by .removeChild()\n        while (display_element.firstChild) {\n          display_element.removeChild(display_element.firstChild);\n        }\n      }\n      var canvas = document.createElement(\"canvas\");\n      canvas.id = \"jspsych-categorize-animation-stimulus\";\n      canvas.style.margin = \"0\";\n      canvas.style.padding = \"0\";\n      display_element.insertBefore(canvas, null);\n      var ctx = canvas.getContext(\"2d\");\n      if (trial.prompt !== null) {\n        var prompt_div = document.createElement(\"div\");\n        prompt_div.id = \"jspsych-categorize-animation-prompt\";\n        prompt_div.style.visibility = \"hidden\";\n        prompt_div.innerHTML = trial.prompt;\n        display_element.insertBefore(prompt_div, canvas.nextElementSibling);\n      }\n      var feedback_div = document.createElement(\"div\");\n      display_element.insertBefore(feedback_div, display_element.nextElementSibling);\n    }\n\n    const update_display = () => {\n      if (showAnimation) {\n        if (trial.render_on_canvas) {\n          display_element.querySelector<HTMLElement>(\n            \"#jspsych-categorize-animation-stimulus\"\n          ).style.visibility = \"visible\";\n          var img = new Image();\n          img.src = trial.stimuli[animate_frame];\n          canvas.height = img.naturalHeight;\n          canvas.width = img.naturalWidth;\n          ctx.drawImage(img, 0, 0);\n        } else {\n          display_element.innerHTML +=\n            '<img src=\"' +\n            trial.stimuli[animate_frame] +\n            '\" class=\"jspsych-categorize-animation-stimulus\"></img>';\n        }\n      }\n\n      if (!responded && trial.allow_response_before_complete) {\n        // in here if the user can respond before the animation is done\n        if (trial.prompt !== null) {\n          if (trial.render_on_canvas) {\n            prompt_div.style.visibility = \"visible\";\n          } else {\n            display_element.innerHTML += trial.prompt;\n          }\n        }\n        if (trial.render_on_canvas) {\n          if (!showAnimation) {\n            canvas.remove();\n          }\n        }\n      } else if (!responded) {\n        // in here if the user has to wait to respond until animation is done.\n        // if this is the case, don't show the prompt until the animation is over.\n        if (!showAnimation) {\n          if (trial.prompt !== null) {\n            if (trial.render_on_canvas) {\n              prompt_div.style.visibility = \"visible\";\n            } else {\n              display_element.innerHTML += trial.prompt;\n            }\n          }\n          if (trial.render_on_canvas) {\n            canvas.remove();\n          }\n        }\n      } else {\n        // user has responded if we get here.\n\n        // show feedback\n        var feedback_text = \"\";\n        if (correct) {\n          feedback_text = trial.correct_text.replace(\"%ANS%\", trial.text_answer);\n        } else {\n          feedback_text = trial.incorrect_text.replace(\"%ANS%\", trial.text_answer);\n        }\n        if (trial.render_on_canvas) {\n          if (trial.prompt !== null) {\n            prompt_div.remove();\n          }\n          feedback_div.innerHTML = feedback_text;\n        } else {\n          display_element.innerHTML += feedback_text;\n        }\n\n        // set timeout to clear feedback\n        if (!timeoutSet) {\n          timeoutSet = true;\n          this.jsPsych.pluginAPI.setTimeout(() => {\n            endTrial();\n          }, trial.feedback_duration);\n        }\n      }\n    };\n\n    // show animation\n    var animate_interval = setInterval(() => {\n      if (!trial.render_on_canvas) {\n        display_element.innerHTML = \"\"; // clear everything\n      }\n      animate_frame++;\n      if (animate_frame == trial.stimuli.length) {\n        animate_frame = 0;\n        reps++;\n        // check if reps complete //\n        if (trial.sequence_reps != -1 && reps >= trial.sequence_reps) {\n          // done with animation\n          showAnimation = false;\n        }\n      }\n\n      update_display();\n    }, trial.frame_time);\n\n    update_display();\n\n    const endTrial = () => {\n      clearInterval(animate_interval); // stop animation!\n      this.jsPsych.finishTrial(trial_data);\n    };\n\n    var keyboard_listener;\n    var trial_data = {};\n\n    // @ts-expect-error Error is: Unreachable code detected: Not all code paths return a value\n    const after_response = (info: { key: string; rt: number }) => {\n      // ignore the response if animation is playing and subject\n      // not allowed to respond before it is complete\n      if (!trial.allow_response_before_complete && showAnimation) {\n        return false;\n      }\n\n      correct = false;\n      if (this.jsPsych.pluginAPI.compareKeys(trial.key_answer, info.key)) {\n        correct = true;\n      }\n\n      responded = true;\n\n      trial_data = {\n        stimulus: trial.stimuli,\n        rt: info.rt,\n        correct: correct,\n        response: info.key,\n      };\n\n      this.jsPsych.pluginAPI.cancelKeyboardResponse(keyboard_listener);\n    };\n\n    keyboard_listener = this.jsPsych.pluginAPI.getKeyboardResponse({\n      callback_function: after_response,\n      valid_responses: trial.choices,\n      rt_method: \"performance\",\n      persist: true,\n      allow_held_key: false,\n    });\n  }\n\n  simulate(\n    trial: TrialType<Info>,\n    simulation_mode,\n    simulation_options: any,\n    load_callback: () => void\n  ) {\n    if (simulation_mode == \"data-only\") {\n      load_callback();\n      this.simulate_data_only(trial, simulation_options);\n    }\n    if (simulation_mode == \"visual\") {\n      this.simulate_visual(trial, simulation_options, load_callback);\n    }\n  }\n\n  private create_simulation_data(trial: TrialType<Info>, simulation_options) {\n    const animation_length = trial.sequence_reps * trial.frame_time * trial.stimuli.length;\n    const key = this.jsPsych.pluginAPI.getValidKey(trial.choices);\n\n    const default_data = {\n      stimulus: trial.stimuli,\n      rt: animation_length + this.jsPsych.randomization.sampleExGaussian(500, 50, 1 / 150, true),\n      response: key,\n      correct: key == trial.key_answer,\n    };\n\n    const data = this.jsPsych.pluginAPI.mergeSimulationData(default_data, simulation_options);\n\n    this.jsPsych.pluginAPI.ensureSimulationDataConsistency(trial, data);\n\n    return data;\n  }\n\n  private simulate_data_only(trial: TrialType<Info>, simulation_options) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    if (data.rt == null || data.response == null) {\n      throw new Error(`\n        Simulated response for categorize-animation plugin was invalid. \n        This could be because the response RT was too fast and generated\n        before the animation finished when the allow_response_before_complete\n        parameter is false. In a real experiment this would cause the experiment\n        to pause indefinitely.`);\n    } else {\n      this.jsPsych.finishTrial(data);\n    }\n  }\n\n  private simulate_visual(trial: TrialType<Info>, simulation_options, load_callback: () => void) {\n    const data = this.create_simulation_data(trial, simulation_options);\n\n    const display_element = this.jsPsych.getDisplayElement();\n\n    this.trial(display_element, trial);\n    load_callback();\n\n    if (data.rt !== null) {\n      this.jsPsych.pluginAPI.pressKey(data.response, data.rt);\n    } else {\n      throw new Error(`\n        Simulated response for categorize-animation plugin was invalid. \n        This could be because the response RT was too fast and generated\n        before the animation finished when the allow_response_before_complete\n        parameter is false. In a real experiment this would cause the experiment\n        to pause indefinitely.`);\n    }\n  }\n}\n\nexport default CategorizeAnimationPlugin;\n"],"names":["version","ParameterType","info"],"mappings":"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"}