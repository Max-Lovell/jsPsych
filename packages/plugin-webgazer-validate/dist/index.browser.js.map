{"version":3,"file":"index.browser.js","sources":["../src/index.ts"],"sourcesContent":["import type WebGazerExtension from \"@jspsych/extension-webgazer\";\nimport { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nimport { version } from \"../package.json\";\n\nconst info = <const>{\n  name: \"webgazer-validate\",\n  version: version,\n  parameters: {\n    /** Array of points in [x,y] coordinates */\n    validation_points: {\n      type: ParameterType.INT, // TO DO: nested array, so different type?\n      default: [\n        [10, 10],\n        [10, 50],\n        [10, 90],\n        [50, 10],\n        [50, 50],\n        [50, 90],\n        [90, 10],\n        [90, 50],\n        [90, 90],\n      ],\n      array: true,\n    },\n    /**\n     * Are the validation_points specified as percentages of screen width and height, or the distance in pixels from the center of the screen?\n     * Options are 'percent' and 'center-offset-pixels'\n     */\n    validation_point_coordinates: {\n      type: ParameterType.SELECT,\n      default: \"percent\",\n      options: [\"percent\", \"center-offset-pixels\"],\n    },\n    /** Tolerance around validation point in pixels */\n    roi_radius: {\n      type: ParameterType.INT,\n      default: 200,\n    },\n    /** Whether or not to randomize the order of validation points */\n    randomize_validation_order: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Delay before validating after showing a point */\n    time_to_saccade: {\n      type: ParameterType.INT,\n      default: 1000,\n    },\n    /** Length of time to show each point */\n    validation_duration: {\n      type: ParameterType.INT,\n      default: 2000,\n    },\n    /** Validation point size in pixels */\n    point_size: {\n      type: ParameterType.INT,\n      default: 20,\n    },\n    /** If true, then validation data will be shown on the screen after validation is complete */\n    show_validation_data: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n  },\n  data: {\n    /** Raw gaze data for the trial. The array will contain a nested array for each validation point. Within each nested array will be a list of `{x,y,dx,dy}` values specifying the absolute x and y pixels, as well as the distance from the target for that gaze point. */\n    raw_gaze: {\n      type: ParameterType.COMPLEX,\n      array: true,\n      nested: {\n        x: {\n          type: ParameterType.INT,\n        },\n        y: {\n          type: ParameterType.INT,\n        },\n        dx: {\n          type: ParameterType.INT,\n        },\n        dy: {\n          type: ParameterType.INT,\n        },\n      },\n    },\n    /** The percentage of samples within the `roi_radius` for each validation point. */\n    percent_in_roi: {\n      type: ParameterType.FLOAT,\n      array: true,\n    },\n    /** The average `x` and `y` distance from each validation point, plus the median distance `r` of the points from this average offset. */\n    average_offset: {\n      type: ParameterType.FLOAT,\n      array: true,\n    },\n    /** The average number of samples per second. Calculated by finding samples per second for each point and then averaging these estimates together. */\n    samples_per_sec: {\n      type: ParameterType.FLOAT,\n    },\n    /** The list of validation points, in the order that they appeared. */\n    validation_points: {\n      type: ParameterType.INT,\n      array: true,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * This plugin can be used to measure the accuracy and precision of gaze predictions made by the\n * [WebGazer extension](../extensions/webgazer.md). For a narrative description of eye tracking with jsPsych,\n * see the [eye tracking overview](../overview/eye-tracking.md).\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/webgazer-validate/ webgazer-validate plugin} and\n * {@link https://www.jspsych.org/latest/overview/eye-tracking/ eye-tracking overview} documentation on jspsych.org\n */\nclass WebgazerValidatePlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    const extension = this.jsPsych.extensions.webgazer as WebGazerExtension;\n\n    var trial_data = <any>{};\n    trial_data.raw_gaze = [];\n    trial_data.percent_in_roi = [];\n    trial_data.average_offset = [];\n    trial_data.validation_points = null;\n\n    var html = `\n        <div id='webgazer-validate-container' style='position: relative; width:100vw; height:100vh; overflow: hidden;'>\n        </div>`;\n\n    display_element.innerHTML = html;\n\n    var wg_container = display_element.querySelector(\"#webgazer-validate-container\");\n\n    var points_completed = -1;\n    var val_points = null;\n    var start = performance.now();\n\n    // function to end trial when it is time\n    const end_trial = () => {\n      extension.stopSampleInterval();\n\n      // move on to the next trial\n      this.jsPsych.finishTrial(trial_data);\n    };\n\n    const validation_display = (pt) => {\n      var pt_html = drawValidationPoint(pt[0], pt[1]);\n      wg_container.innerHTML = pt_html;\n\n      var pt_dom = wg_container.querySelector(\".validation-point\");\n\n      var br = pt_dom.getBoundingClientRect();\n      var x = br.left + br.width / 2;\n      var y = br.top + br.height / 2;\n\n      var pt_start_val = performance.now() + trial.time_to_saccade;\n      var pt_finish = pt_start_val + trial.validation_duration;\n\n      var pt_data = [];\n\n      var cancelGazeUpdate = extension.onGazeUpdate((prediction) => {\n        if (performance.now() > pt_start_val) {\n          pt_data.push({\n            x: prediction.x,\n            y: prediction.y,\n            dx: prediction.x - x,\n            dy: prediction.y - y,\n            t: Math.round(prediction.t - start),\n          });\n        }\n      });\n\n      requestAnimationFrame(function watch_dot() {\n        if (performance.now() < pt_finish) {\n          requestAnimationFrame(watch_dot);\n        } else {\n          trial_data.raw_gaze.push(pt_data);\n          cancelGazeUpdate();\n\n          next_validation_point();\n        }\n      });\n    };\n\n    const next_validation_point = () => {\n      points_completed++;\n      if (points_completed == val_points.length) {\n        validation_done();\n      } else {\n        var pt = val_points[points_completed];\n        validation_display(pt);\n      }\n    };\n\n    const validate = () => {\n      if (trial.randomize_validation_order) {\n        val_points = this.jsPsych.randomization.shuffle(trial.validation_points);\n      } else {\n        val_points = trial.validation_points;\n      }\n      trial_data.validation_points = val_points;\n      points_completed = -1;\n      //extension.resume();\n      extension.startSampleInterval();\n      //extension.showPredictions();\n      next_validation_point();\n    };\n\n    const show_validation_data = () => {\n      var html = \"\";\n      for (var i = 0; i < trial.validation_points.length; i++) {\n        html += drawValidationPoint(trial.validation_points[i][0], trial.validation_points[i][1]);\n        html += drawCircle(\n          trial.validation_points[i][0],\n          trial.validation_points[i][1],\n          0,\n          0,\n          trial.roi_radius\n        );\n        for (var j = 0; j < trial_data.raw_gaze[i].length; j++) {\n          html += drawRawDataPoint(\n            trial.validation_points[i][0],\n            trial.validation_points[i][1],\n            trial_data.raw_gaze[i][j].dx,\n            trial_data.raw_gaze[i][j].dy\n          );\n        }\n      }\n\n      html +=\n        '<button id=\"cont\" style=\"position:absolute; top: 50%; left:calc(50% - 50px); width: 100px;\" class=\"jspsych-btn\">Continue</btn>';\n      wg_container.innerHTML = html;\n      wg_container.querySelector(\"#cont\").addEventListener(\"click\", () => {\n        extension.pause();\n        end_trial();\n      });\n      // turn on webgazer's loop\n      extension.showPredictions();\n      extension.stopSampleInterval();\n      extension.resume();\n    };\n\n    const validation_done = () => {\n      trial_data.samples_per_sec = calculateSampleRate(trial_data.raw_gaze).toFixed(2);\n      for (var i = 0; i < trial.validation_points.length; i++) {\n        trial_data.percent_in_roi[i] = calculatePercentInROI(trial_data.raw_gaze[i]);\n        trial_data.average_offset[i] = calculateGazeCentroid(trial_data.raw_gaze[i]);\n      }\n      if (trial.show_validation_data) {\n        show_validation_data();\n      } else {\n        end_trial();\n      }\n    };\n\n    validate();\n\n    // @ts-expect-error\n    function drawValidationPoint(x, y) {\n      if (trial.validation_point_coordinates == \"percent\") {\n        return drawValidationPoint_PercentMode(x, y);\n      }\n      if (trial.validation_point_coordinates == \"center-offset-pixels\") {\n        return drawValidationPoint_CenterOffsetMode(x, y);\n      }\n    }\n\n    function drawValidationPoint_PercentMode(x, y) {\n      return `<div class=\"validation-point\" style=\"width:${trial.point_size}px; height:${trial.point_size}px; border-radius:${trial.point_size}px; border: 1px solid #000; background-color: #333; position: absolute; left:${x}%; top:${y}%;\"></div>`;\n    }\n\n    function drawValidationPoint_CenterOffsetMode(x, y) {\n      return `<div class=\"validation-point\" style=\"width:${trial.point_size}px; height:${\n        trial.point_size\n      }px; border-radius:${\n        trial.point_size\n      }px; border: 1px solid #000; background-color: #333; position: absolute; left:calc(50% - ${\n        trial.point_size / 2\n      }px + ${x}px); top:calc(50% - ${trial.point_size / 2}px + ${y}px);\"></div>`;\n    }\n\n    // @ts-expect-error\n    function drawCircle(target_x, target_y, dx, dy, r) {\n      if (trial.validation_point_coordinates == \"percent\") {\n        return drawCircle_PercentMode(target_x, target_y, dx, dy, r);\n      }\n      if (trial.validation_point_coordinates == \"center-offset-pixels\") {\n        return drawCircle_CenterOffsetMode(target_x, target_y, dx, dy, r);\n      }\n    }\n\n    function drawCircle_PercentMode(target_x, target_y, dx, dy, r) {\n      var html = `\n          <div class=\"validation-centroid\" style=\"width:${r * 2}px; height:${\n        r * 2\n      }px; border: 2px dotted #ccc; border-radius: ${r}px; background-color: transparent; position: absolute; left:calc(${target_x}% + ${\n        dx - r\n      }px); top:calc(${target_y}% + ${dy - r}px);\"></div>\n        `;\n      return html;\n    }\n\n    function drawCircle_CenterOffsetMode(target_x, target_y, dx, dy, r) {\n      var html = `\n          <div class=\"validation-centroid\" style=\"width:${r * 2}px; height:${\n        r * 2\n      }px; border: 2px dotted #ccc; border-radius: ${r}px; background-color: transparent; position: absolute; left:calc(50% + ${target_x}px + ${\n        dx - r\n      }px); top:calc(50% + ${target_y}px + ${dy - r}px);\"></div>\n        `;\n      return html;\n    }\n\n    // @ts-expect-error\n    function drawRawDataPoint(target_x, target_y, dx, dy) {\n      if (trial.validation_point_coordinates == \"percent\") {\n        return drawRawDataPoint_PercentMode(target_x, target_y, dx, dy);\n      }\n      if (trial.validation_point_coordinates == \"center-offset-pixels\") {\n        return drawRawDataPoint_CenterOffsetMode(target_x, target_y, dx, dy);\n      }\n    }\n\n    function drawRawDataPoint_PercentMode(target_x, target_y, dx, dy) {\n      var color = Math.sqrt(dx * dx + dy * dy) <= trial.roi_radius ? \"#afa\" : \"#faa\";\n      return `<div class=\"raw-data-point\" style=\"width:5px; height:5px; border-radius:5px; background-color: ${color}; opacity:0.8; position: absolute; left:calc(${target_x}% + ${\n        dx - 2\n      }px); top:calc(${target_y}% + ${dy - 2}px);\"></div>`;\n    }\n\n    function drawRawDataPoint_CenterOffsetMode(target_x, target_y, dx, dy) {\n      var color = Math.sqrt(dx * dx + dy * dy) <= trial.roi_radius ? \"#afa\" : \"#faa\";\n      return `<div class=\"raw-data-point\" style=\"width:5px; height:5px; border-radius:5px; background-color: ${color}; opacity:0.8; position: absolute; left:calc(50% + ${target_x}px + ${\n        dx - 2\n      }px); top:calc(50% + ${target_y}px + ${dy - 2}px);\"></div>`;\n    }\n\n    function median(arr) {\n      var mid = Math.floor(arr.length / 2);\n      var sorted_arr = arr.sort((a, b) => a - b);\n      if (arr.length % 2 == 0) {\n        return sorted_arr[mid - 1] + sorted_arr[mid] / 2;\n      } else {\n        return sorted_arr[mid];\n      }\n    }\n\n    function calculateGazeCentroid(gazeData) {\n      var x_diff_m = gazeData.reduce((accumulator, currentValue, index) => {\n        accumulator += currentValue.dx;\n        if (index == gazeData.length - 1) {\n          return accumulator / gazeData.length;\n        } else {\n          return accumulator;\n        }\n      }, 0);\n\n      var y_diff_m = gazeData.reduce((accumulator, currentValue, index) => {\n        accumulator += currentValue.dy;\n        if (index == gazeData.length - 1) {\n          return accumulator / gazeData.length;\n        } else {\n          return accumulator;\n        }\n      }, 0);\n\n      var median_distance = median(\n        gazeData.map((x) => Math.sqrt(Math.pow(x.dx - x_diff_m, 2) + Math.pow(x.dy - y_diff_m, 2)))\n      );\n\n      return {\n        x: x_diff_m,\n        y: y_diff_m,\n        r: median_distance,\n      };\n    }\n\n    function calculatePercentInROI(gazeData) {\n      var distances = gazeData.map((p) => Math.sqrt(Math.pow(p.dx, 2) + Math.pow(p.dy, 2)));\n      var sum_in_roi = distances.reduce((accumulator, currentValue) => {\n        if (currentValue <= trial.roi_radius) {\n          accumulator++;\n        }\n        return accumulator;\n      }, 0);\n      var percent = (sum_in_roi / gazeData.length) * 100;\n      return percent;\n    }\n\n    function calculateSampleRate(gazeData) {\n      var mean_diff = [];\n      if (gazeData.length == 0) {\n        return 0;\n      }\n      for (var i = 0; i < gazeData.length; i++) {\n        if (gazeData[i].length > 1) {\n          var t_diff = [];\n          for (var j = 1; j < gazeData[i].length; j++) {\n            t_diff.push(gazeData[i][j].t - gazeData[i][j - 1].t);\n          }\n          mean_diff.push(t_diff.reduce((a, b) => a + b, 0) / t_diff.length);\n        }\n      }\n      if (mean_diff.length > 0) {\n        return 1000 / (mean_diff.reduce((a, b) => a + b, 0) / mean_diff.length);\n      } else {\n        return null;\n      }\n    }\n  }\n}\n\nexport default WebgazerValidatePlugin;\n"],"names":["version","ParameterType","html"],"mappings":"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"}